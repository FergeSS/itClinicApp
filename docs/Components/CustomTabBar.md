# Кастомный TabBar

## Общее описание
Кастомный нижний таббар (NavigationBar) с уникальным дизайном, используемый на главном экране приложения для переключения между основными разделами.

## Дизайн-спецификация

### Контейнер таббара
- **Размеры**: 380×60 dp
- **Отступ снизу**: 40dp (таббар приподнят над нижним краем экрана)
- **Цвет фона**: `#9F2D20` (бордовый)
- **Обводка**: 2px, цвет `#CF3F2F` (светло-красный)
- **Закругление углов**: 25dp (скругленный)
- **Тень**: 
  - Смещение: (0, 6)
  - Blur: 8dp
  - Цвет: Черный с прозрачностью 15%

### Индикатор выбранной вкладки
- **Размеры**: 123×50 dp
- **Закругление углов**: 25dp
- **Фон**: Градиент (вертикальный, сверху вниз)
  - Верхний цвет: `#CF3F2F` с прозрачностью 70%
  - Нижний цвет: `#B13123` с прозрачностью 70%
- **Тень**: 
  - Смещение: (0, 2)
  - Blur: 2dp
  - Цвет: Черный с прозрачностью 20%
- **Анимация**: При переключении вкладки индикатор плавно перемещается к новой позиции (300ms, tween animation)
- **Перетаскивание**: Индикатор можно перетаскивать горизонтально для переключения между вкладками. При отпускании автоматически переключается на ближайшую вкладку

### Иконки вкладок

#### Невыбранная вкладка
- **Цвет иконки**: `#A6A6A6` (серый)

#### Выбранная вкладка
- **Цвет иконки**: `#FFFFFF` (белый)

#### Интерактивность
- **При нажатии**: Иконка увеличивается на 15% (scale 1.15) с анимацией 150ms
- **Затемнение отключено**: Вместо стандартного затемнения используется анимация увеличения

### Расположение и размеры иконок

1. **Проекты (СПбГУ лого)**
   - Ресурс: `spbu_tab_logo.png`
   - Размер: 33×41 dp
   - Позиция: Левая вкладка

2. **Статистика**
   - Ресурс: `stats_tab_logo.png`
   - Размер: 30×27.5 dp
   - Позиция: Центральная вкладка

3. **Настройки**
   - Ресурс: `settings_tab_logo.png`
   - Размер: 30×30 dp
   - Позиция: Правая вкладка

## Реализация

### Файлы
- **Компонент**: `/composeApp/src/commonMain/kotlin/com/spbu/projecttrack/main/presentation/MainScreen.kt`
- **Функция**: `CustomTabBar()`

### Ресурсы
- `/composeApp/src/commonMain/composeResources/drawable/spbu_tab_logo.png`
- `/composeApp/src/commonMain/composeResources/drawable/stats_tab_logo.png`
- `/composeApp/src/commonMain/composeResources/drawable/settings_tab_logo.png`

### Структура компонента

```kotlin
@Composable
private fun CustomTabBar(
    selectedTab: Int,
    onTabSelected: (Int) -> Unit,
    modifier: Modifier = Modifier
)
```

**Параметры:**
- `selectedTab: Int` - индекс текущей выбранной вкладки (0-2)
- `onTabSelected: (Int) -> Unit` - callback для обработки переключения вкладок

### Анимация

Используется `animateDpAsState` для плавного перемещения индикатора выбора между вкладками:

```kotlin
val offsetX by animateDpAsState(
    targetValue = when (selectedTab) {
        0 -> 5.dp      // Позиция первой вкладки
        1 -> 128.5.dp  // Позиция второй вкладки (центр)
        2 -> 252.dp    // Позиция третьей вкладки
        else -> 5.dp
    },
    animationSpec = tween(durationMillis = 300)
)
```

### Расчет позиций

- **Ширина таббара**: 380dp
- **Ширина вкладки**: 123dp (≈ 380dp / 3)
- **Отступ индикатора**: 5dp (вертикальный, для центрирования в 60dp контейнере)

**Горизонтальные позиции индикатора:**
- Вкладка 1: 5dp (с учетом небольшого отступа слева)
- Вкладка 2: 128.5dp (центр таббара)
- Вкладка 3: 252dp (правая часть)

## Использование

Таббар интегрирован в `MainScreen` и автоматически управляет навигацией между тремя основными экранами:

```kotlin
Scaffold(
    bottomBar = {
        CustomTabBar(
            selectedTab = selectedTab,
            onTabSelected = { selectedTab = it }
        )
    }
) { paddingValues ->
    when (selectedTab) {
        0 -> ProjectsScreen(...)
        1 -> RankingScreen()
        2 -> InfoScreen()
    }
}
```

## Эффекты и UX

1. **Плавная анимация**: Индикатор выбора перемещается с анимацией 300ms между вкладками
2. **Перетаскивание индикатора**: Пользователь может перетаскивать индикатор выбора для быстрого переключения между вкладками
3. **Визуальная обратная связь**: 
   - Цвет иконки меняется при выборе (серый → белый)
   - Иконка увеличивается на 15% при нажатии (вместо затемнения)
4. **Градиентный фон**: Индикатор использует градиент для создания глубины
5. **Тени**: Многоуровневые тени создают эффект "приподнятого" интерфейса
6. **Скругление**: Таббар имеет скругление 25dp для современного вида
7. **iOS 26-стиль**: Анимация похожа на новый таббар в iOS 26, но без эффекта стекла

## Вдохновение

Дизайн вдохновлен новым стилем таббара в iOS 26, где индикатор выбора плавно перемещается между вкладками, создавая современный и приятный UX.

## Технические детали

### ColorFilter для иконок
Используется `ColorFilter.tint()` для динамического изменения цвета PNG-иконок в зависимости от состояния выбора:

```kotlin
colorFilter = ColorFilter.tint(
    if (isSelected) SelectedTabColor else UnselectedTabColor
)
```

### Shadow композиция
Для создания многослойного эффекта используется комбинация:
1. Shadow на контейнере таббара (elevation 8dp)
2. Shadow на индикаторе выбора (elevation 2dp)

### Центрирование и позиционирование
Таббар центрируется на экране и приподнят на 40dp от нижнего края:
```kotlin
Box(
    modifier = Modifier
        .fillMaxWidth()
        .height(60.dp)
        .padding(bottom = 40.dp), // Поднимаем таббар на 40dp
    contentAlignment = Alignment.Center
) {
    Box(modifier = Modifier.width(380.dp)) { /* TabBar content */ }
}
```

### Перетаскивание индикатора
Индикатор выбора поддерживает горизонтальное перетаскивание:
- Используется `detectHorizontalDragGestures` для отслеживания жеста
- При перетаскивании индикатор следует за пальцем в реальном времени
- При отпускании автоматически определяется ближайшая вкладка и происходит переключение
- Перетаскивание ограничено пределами таббара

### Анимация увеличения иконок
При нажатии на вкладку иконка увеличивается:
```kotlin
val scale by animateFloatAsState(
    targetValue = if (isPressed) 1.15f else 1f,
    animationSpec = tween(durationMillis = 150)
)
```
Используется `MutableInteractionSource` для отслеживания состояния нажатия без стандартного затемнения (`indication = null`).

## Будущие улучшения
- [x] Добавить перетаскивание индикатора для переключения вкладок
- [x] Добавить анимацию увеличения иконок при нажатии
- [x] Добавить скругление таббара (25dp)
- [x] Поднять таббар над нижним краем экрана (40dp)
- [ ] Добавить haptic feedback при переключении вкладок
- [ ] Добавить badge-индикаторы для уведомлений
- [ ] Добавить долгое нажатие для дополнительных действий
- [ ] Реализовать адаптивную ширину для разных размеров экранов
- [ ] Добавить accessibility labels для screen readers

